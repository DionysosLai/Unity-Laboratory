# PBR 流程

20210515 



## 1. 漫反射与镜面反射

![image-20210515145056226](https://raw.githubusercontent.com/DionysosLai/PicGoImage/main/20210515145058.png)

​	相对来说，镜面反射就是直接反射，漫反射是光被物体吸收之后，再反射出来。（这点，可以跟微平面联系起来)

## 2. 金属与非金属

PBR 的核心就是将物体区分微金属与非金属。

对于一个金属来说，它的镜面反射率是非常高的（70~100%）。也就是说，光落在一个金属上，**绝大多数直接被镜面反射、剩下的被吸收，几乎没有任何光通过漫反射再射出。**

而对于一个非金属来说，它的镜面反射率是很低的（2~5%）。也就是说，当光落在一个非金属上，**绝大多数光都进入了物体内部，其中一部分被吸收，另一部分作为漫反射射出。**

所以我们很容易得出一个结论：**金属的最终效果取决于镜面反射，非金属的最终效果取决于漫反射。**

物体的最终成像是由返回给你的光的强度和颜色决定。

对于镜面反射而言，除了“镜面反射率”决定起反射光的总强度之外，还有一个“表面粗糙度“（roughness）”决定了实际反射效果（光斑大小）。即**表面越粗糙，镜面反射的光越分散，表现出来光斑越大，亮度越低（这是因为强度不会改变）**

对于漫反射而言，它的强度取决于“镜面反射率”和“吸收率”，即 除了**漫反射 = 光照 - 镜面反射 - 吸收**。

注意镜面反射和漫反射都是有颜色的，取决于物体本身的材质。

因此，我们模拟一个物体的光照效果，需要的数据来源于：镜面反射颜色（强度，决定了镜面反射亮度）、漫反射颜色（强度，决定了漫反射亮度）和表面粗糙度（决定了光斑大小）。

## 3. 所谓的F0与菲涅尔

我们观察到一种现象，**当物体与你的视角夹角不同时，物体的镜面反射率是不同的**，理论上你视角与物体的夹角越大，物体的镜面反射率越高、并无限趋近于100%

![image-20210515163054959](https://raw.githubusercontent.com/DionysosLai/PicGoImage/main/20210515163055.png)

我们所提到的所有“镜面反射率”，都是指掠穹角下（即你垂直观察物体）时的反射率。**当你的视角与物体发生偏转，这个值是在递增改变的。**注意，递增

从某种简化的理解上来说，神奇的F0就是“镜面反射率”。它是指物体在绝对垂直于视角情况下的镜面反射率。



## 4. PBR制作流程

两套流程，一套“金属度/粗糙度”流程，一套叫“镜面反射/光泽度”流程。

### 4.1 金属度/粗糙度流程

**反照率贴图**（Albedo，RGB）

存储的是“金属的镜面反射颜色和非金属的漫反射颜色”

**金属度贴图**（灰度）

规定了物体是否是金属。1是金属，0是非金属。

**粗糙度贴图**（灰度）

存储物体的表面粗糙度信息，1位非常粗糙，0位非常光滑。

注意，这里没有提到“金属的漫反射颜色”和“非金属的镜面反射颜色”。这是因为金属几乎是没有漫反射的，所以我们完全不必储存这个信息，全当它是0就好了。同样，非金属的镜面反射也是非常微弱的、不同材质的差距也小，所以在“金属/粗糙度”流程里，程序直接将非金属的镜面反射率（F0）当成了0.04

### 4.2  镜面反射/光泽度流程

**漫反射贴图**（Diffuse, RGB)

存储漫反射颜色信息。在这张图中，金属部分填充黑色；非金属部分填充正常漫反射颜色。

**镜面反射贴图**（RGB）

存储镜面反射信息。同样，非金属的镜面反射信息填成灰黑色。

**光泽度贴图**（灰度）

实际上就是表面粗糙度贴图的反转。1代表非常光滑，0代表非常粗糙。

---

在金属/粗糙度流程里，最明显的优势就是它的贴图没有任何浪费，总共只使用了五个通道就解决了信息问题。但它的问题在于，为了节约通道，它默认了非金属的镜面反射率，这从一定程度上限制了我们的设计发挥。

在镜面反射/光泽度流程里，它敞开了所有数据供我们在贴图中调整，但这导致它不得不使用两张彩色图，造成了一定程度上的存储浪费（在两张彩色图中都有部分仅存储了灰度信息）



# 附录

以上内容，基本摘自：https://zhuanlan.zhihu.com/p/370199277